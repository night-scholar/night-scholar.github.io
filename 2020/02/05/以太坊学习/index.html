<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Night Scholar">





<title>智能合约Solidity学习 | Hexo</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 5.4.0"></head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">夜行书生&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">文章</a>
                
                    <a class="menu-item" href="/category">分类</a>
                
                    <a class="menu-item" href="/tag">标签</a>
                
                    <a class="menu-item" href="/about">关于</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">夜行书生&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">文章</a>
                
                    <a class="menu-item" href="/category">分类</a>
                
                    <a class="menu-item" href="/tag">标签</a>
                
                    <a class="menu-item" href="/about">关于</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
        
            <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">全部展开</a>
        <a onclick="go_top()">回到首部</a>
        <a onclick="go_bottom()">直达底部</a>
    </div>
</div>

<script>
    document.ready(
        function() {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "全部折叠"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "全部展开"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }
</script>
                

                    
                        <article class="post-wrap">
                            <header class="post-header">
                                <h1 class="post-title">
                                    智能合约Solidity学习
                                </h1>
                                
                                    <div class="post-meta">
                                        
                                            Author:
                                            <a itemprop="author" rel="author" href="/">
                                                Night Scholar
                                            </a>
                                            

                                                
                                                    <span class="post-time">
                        Date: <a href="#">February 5, 2020&nbsp;&nbsp;19:55:02</a>
                        </span>
                                                    
                                                        
                                                            <span class="post-category">
                    Category:
                            
                                <a href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链</a>
                            
                        </span>
                                                            
                                    </div>
                                    
                            </header>

                            <div class="post-content">
                                <h1 id="以太坊学习"><a href="#以太坊学习" class="headerlink" title="以太坊学习"></a>以太坊学习</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">remixd -s D:\GoCode\以太坊 ##连接本地</span><br></pre></td></tr></table></figure>

<h2 id="合约结构"><a href="#合约结构" class="headerlink" title="合约结构"></a>合约结构</h2><h3 id="状态变量"><a href="#状态变量" class="headerlink" title="状态变量"></a>状态变量</h3><p>变量值会永久存储在合约的存储空间</p>
<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>智能合约中的一个可执行单元</p>
<h3 id="函数修饰符"><a href="#函数修饰符" class="headerlink" title="函数修饰符"></a>函数修饰符</h3><p>在函数声明时，增强函数语义，满足条件时才会执行函数</p>
<h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><p>用于日志输出，便于跟踪调试</p>
<h3 id="结构体类型"><a href="#结构体类型" class="headerlink" title="结构体类型"></a>结构体类型</h3><p>用户自定义的将几个变量组合在一起形成的类型</p>
<h3 id="枚举类型"><a href="#枚举类型" class="headerlink" title="枚举类型"></a>枚举类型</h3><p>特殊的自定义类型，类型的所有值可枚举的情况</p>
<h2 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h2><h3 id="1-值类型"><a href="#1-值类型" class="headerlink" title="1.值类型"></a>1.值类型</h3><p>指变量在传递过程中是将数值完整的拷贝一份，再赋值给新的变量，这种方式需要开辟新的内存空间，效率较低，两个变量完全独立，修改一个不会影响另一个。</p>
<p>整型、布尔、地址、定长字节数组、有理数和整型、枚举类型、函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.20</span>;</span><br><span class="line"></span><br><span class="line">contract Student&#123;</span><br><span class="line">    uint _score = <span class="number">80</span>;</span><br><span class="line">    uint _num = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//public可以输入变量执行</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">exectue</span>(<span class="params">uint score</span>) <span class="title">public</span></span>&#123;</span><br><span class="line">        changeScore(score);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//privte不能输入变量执行，只能其他的函数进行调用</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">changeScore</span>(<span class="params">uint score</span>) <span class="title">private</span> </span>&#123;</span><br><span class="line">        _score = score;</span><br><span class="line">        _num = <span class="number">90</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//constant可以使数据可见</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getScore</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _score;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getNum</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-引用类型"><a href="#2-引用类型" class="headerlink" title="2.引用类型"></a>2.引用类型</h3><p>不定长字节数组、字符串、数组、结构体</p>
<p>memory：相当于值拷贝 </p>
<p>storage：引用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.20</span>;</span><br><span class="line"></span><br><span class="line">contract Student&#123;</span><br><span class="line">    string _name = <span class="string">&quot;ck&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">exectue</span>(<span class="params"></span>) <span class="title">public</span></span>&#123;</span><br><span class="line">        changeName(_name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//storage表示引用，因此传递的是地址</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">changeName</span>(<span class="params">string storage name</span>) <span class="title">private</span> </span>&#123;</span><br><span class="line">        bytes(name)[<span class="number">0</span>] = <span class="string">&quot;C&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">string</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-布尔类型"><a href="#3-布尔类型" class="headerlink" title="3.布尔类型"></a>3.布尔类型</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.20</span>;</span><br><span class="line"></span><br><span class="line">contract BoolTest&#123;</span><br><span class="line">    uint v1 = <span class="number">10</span> ;</span><br><span class="line">    uint v2 = <span class="number">20</span> ;</span><br><span class="line">    bool b1 = <span class="literal">true</span>;</span><br><span class="line">    bool b2 = <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">bool</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> !b1;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f2</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">bool</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b1 &amp;&amp; b2;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f3</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">bool</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> b1 || b2;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f4</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">bool</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> v1 == v2;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f5</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">bool</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> v1 != v2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-整型"><a href="#4-整型" class="headerlink" title="4.整型"></a>4.整型</h3><p>int（有负号） ， uint（无负号），支持int8 到int256，uint同理，int默认为int256，uint默认为uint256</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.21</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">contract IntegerTest &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    //&amp;，|，^（异或），~（位取反）</span></span><br><span class="line"><span class="comment">    10  uint8    1010     </span></span><br><span class="line"><span class="comment">    4   uint8    0100</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    &amp;            0000      0</span></span><br><span class="line"><span class="comment">    |            1110     14</span></span><br><span class="line"><span class="comment">    ^            1110     14 </span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    ~   3  0000,0011  1100     12 </span></span><br><span class="line"><span class="comment">           1111,1100   </span></span><br><span class="line"><span class="comment">           1111,1111 - 3</span></span><br><span class="line"><span class="comment">           2^8 -1 -3 = 256 -4 = 252</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    uint8 a = <span class="number">10</span>;</span><br><span class="line">    uint8 b = <span class="number">4</span>;</span><br><span class="line">    uint8 c = <span class="number">3</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  a &amp; b == <span class="number">0</span>;<span class="comment">//同为真则真</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f2</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  a | b == <span class="number">14</span>;<span class="comment">//一个为真则真</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f3</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  a ^ b == <span class="number">14</span>;<span class="comment">//同为假不同为真</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f4</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ~c == <span class="number">252</span>;<span class="comment">//按位取反 因为使uint8，所以是252</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-地址类型"><a href="#5-地址类型" class="headerlink" title="5.地址类型"></a>5.地址类型</h3><p>以太坊地址的长度，大小为20个字节，160位，可以用一个uint160编码。地址是所有合约的基础，所有的合约都会继承地址对象，也可以随时用一个地址串得到对应代码进行调用。</p>
<h4 id="地址类型的成员："><a href="#地址类型的成员：" class="headerlink" title="地址类型的成员："></a>地址类型的成员：</h4><ol>
<li>属性：balance</li>
<li>方法：send( )、transfer( )、 call( ) 、delegatecall( ) 、callcode( )</li>
</ol>
<h4 id="1-地址类型与整型转换"><a href="#1-地址类型与整型转换" class="headerlink" title="1. 地址类型与整型转换"></a>1. 地址类型与整型转换</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.24</span>;</span><br><span class="line"></span><br><span class="line">contract AddressTest&#123;</span><br><span class="line">    address _add1 =  <span class="number">0x5B38Da6a701c568545dCfcB03FcB875f56beddC4</span>;</span><br><span class="line">    address _add2 =  <span class="number">0x7b96aF9Bd211cBf6BA5b0dd53aa61Dc5806b6AcE</span>;</span><br><span class="line">    uint160 <span class="keyword">public</span> _num = <span class="number">0</span>;</span><br><span class="line">    address <span class="keyword">public</span> _add;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function">function <span class="title">addressTOuint160</span><span class="params">()</span> <span class="keyword">public</span> <span class="title">returns</span> <span class="params">(uint160)</span> </span>&#123;</span><br><span class="line">        _num = uint160(_add1);</span><br><span class="line">        <span class="keyword">return</span> _num;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">function <span class="title">uint160TOaddress</span><span class="params">()</span> <span class="keyword">public</span> <span class="title">returns</span> <span class="params">(address)</span></span>&#123;</span><br><span class="line">        _add = address(_num);</span><br><span class="line">        <span class="keyword">return</span> _add;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-balance获取余额"><a href="#2-balance获取余额" class="headerlink" title="2. balance获取余额"></a>2. balance获取余额</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取当前地址余额</span></span><br><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.24</span>;</span><br><span class="line"></span><br><span class="line">contract addressSender&#123;</span><br><span class="line">    address public _owner ;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//获取查询目标地址</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">senderTest</span>(<span class="params"></span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        _owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//获取余额</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getOwnerBalance</span>(<span class="params"></span>)<span class="title">constant</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _owner.balance;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//获取查询人地址</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getInvoker</span>(<span class="params"></span>)<span class="title">constant</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">address</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-This和payable转账"><a href="#4-This和payable转账" class="headerlink" title="4. This和payable转账"></a>4. This和payable转账</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//This获取合约地址</span></span><br><span class="line"></span><br><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.24</span>;</span><br><span class="line"></span><br><span class="line">contract addressThisTest&#123;</span><br><span class="line">    </span><br><span class="line">    uint _money;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">addressThis</span>(<span class="params"></span>) <span class="title">payable</span> <span class="title">public</span></span>&#123;</span><br><span class="line">        _money=msg.value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getThis</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">address</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getBalance</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">public</span> <span class="title">returns</span>(<span class="params">uint256</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.balance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getMoney</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">public</span> <span class="title">returns</span>(<span class="params">uint</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _money;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-转账transfer"><a href="#5-转账transfer" class="headerlink" title="5. 转账transfer"></a>5. 转账transfer</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//msg.sender获取的是获取本人地址</span></span><br><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.20</span>;</span><br><span class="line"></span><br><span class="line">contract TransferTest&#123;</span><br><span class="line">    address CKNO2 = <span class="number">0xAb8483F64d9C6d1EcF9b849Ae677dD3315835cb2</span>;</span><br><span class="line">    uint _money;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">transfer</span>(<span class="params"></span>) <span class="title">payable</span> <span class="title">public</span></span>&#123;</span><br><span class="line">        CKNO2.transfer(msg.value);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getThis</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">address</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getBalance</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">public</span> <span class="title">returns</span>(<span class="params">uint256</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> CKNO2.balance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-转账send"><a href="#6-转账send" class="headerlink" title="6. 转账send"></a>6. 转账send</h4><p>Send在转账时不会向transfer一样抛出异常，而是返回一个false。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.20</span>;</span><br><span class="line"></span><br><span class="line">contract TransferTest&#123;</span><br><span class="line">    address CKNO2 = <span class="number">0xCF208DD52bB63b08616c1a1bC498b48c544858A8</span>;</span><br><span class="line">    bool res;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">transfer</span>(<span class="params"></span>) <span class="title">payable</span> <span class="title">public</span> <span class="title">returns</span>(<span class="params">bool</span>)</span>&#123;</span><br><span class="line">        res = CKNO2.send(msg.value);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-枚举类型"><a href="#6-枚举类型" class="headerlink" title="6.枚举类型"></a>6.枚举类型</h3><p>枚举类型是一种用户自定义类型。他可以显式的转换与整数进行转换，但不能进行隐式转换。显示的转换会在运行时检查数值范围，如果不匹配，将会引起异常。枚举类型应该至少由一名成员，枚举元素默认为uint8，当元素数量足够多时，会自动变为uint16，第一个元素默认为0，使用超出范围的数值时会报错。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line">contract enumTest &#123;</span><br><span class="line">    enum ActionChoices &#123; GoLeft, GoRight, GoStraight, SitStill &#125; <span class="comment">//uint8类型 看下标</span></span><br><span class="line">    ActionChoices _choice; <span class="comment">//默认为0</span></span><br><span class="line">    ActionChoices  defaultChoice = ActionChoices.GoStraight;<span class="comment">//为GoStraight的下标，2</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setGoStraight</span>(<span class="params">ActionChoices choice</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        _choice = choice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getChoice</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">ActionChoices</span>)  </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _choice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getDefaultChoice</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123;</span><br><span class="line">        <span class="comment">//因为返回值要求为uint类型，即使默认为uint8，但是依旧要进行显式转换</span></span><br><span class="line">        <span class="keyword">return</span> uint(defaultChoice);<span class="comment">//返回值为2</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">isGoLeft</span>(<span class="params">ActionChoices choice</span>) <span class="title">constant</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (choice == ActionChoices.GoLeft)&#123;<span class="comment">//GoLeft为0</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-函数类型"><a href="#7-函数类型" class="headerlink" title="7.函数类型"></a>7.函数类型</h3><p>函数本身也是一个特殊的变量，它可以当作变量赋值，也可以作为函数参数进行传递。它包括：</p>
<ul>
<li><strong>内部类型（internal）：</strong>仅能在合约内部调用，如当前代码块中、内部库函数中、继承的函数中。</li>
<li><strong>外部类型（external）：</strong>仅能在合约外部调用，由地址和函数签名两部分组成，可作为外部函数调用的参数，或者由外部函数调用返回。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.5</span>;</span><br><span class="line"></span><br><span class="line">contract FuntionTest&#123;</span><br><span class="line">    uint public v1;</span><br><span class="line">    uint public v2;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">/* </span></span><br><span class="line"><span class="comment">    function v1() constant returns (uint) &#123;</span></span><br><span class="line"><span class="comment">        return v1;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">//仅能在合约内部调用</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">internalFunc</span>(<span class="params"></span>) <span class="title">internal</span></span>&#123;</span><br><span class="line">        v1 = <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//仅能在合约外部调用</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">externalFunc</span>(<span class="params"></span>) <span class="title">external</span> <span class="title">returns</span> (<span class="params">uint res</span>)</span>&#123;</span><br><span class="line">        v2 = <span class="number">20</span>;</span><br><span class="line">        <span class="keyword">return</span> v2;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">resetV2</span>(<span class="params"></span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        v2 = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">callFunc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">//直接使用内部的方式调用</span></span><br><span class="line">        internalFunc();  <span class="comment">//&lt;--- 合约内部直接调用，正确</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//不能在内部调用一个外部函数，会报编译错误。</span></span><br><span class="line">        <span class="comment">//Error: Undeclared identifier.</span></span><br><span class="line">        <span class="comment">//externalFunc(); //&lt;--- 外部合约可以调用</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//不能通过`external`的方式调用一个`internal`</span></span><br><span class="line">        <span class="comment">//Member &quot;internalFunc&quot; not found or not visible after argument-dependent lookup in contract FuntionTest</span></span><br><span class="line">        <span class="comment">//this.internalFunc();  //&lt;--- this相当于外部调用</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用`this`以`external`的方式调用一个外部函数</span></span><br><span class="line">        <span class="built_in">this</span>.externalFunc();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Son is FuntionTest &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">callInternalFunc</span>(<span class="params"></span>)  <span class="title">public</span></span>&#123;</span><br><span class="line">        internalFunc();</span><br><span class="line">        <span class="comment">//externalFunc();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract FunctionTest1&#123;</span><br><span class="line">    uint public v3;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">externalCall</span>(<span class="params">FuntionTest ft</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//调用另一个合约的外部函数</span></span><br><span class="line">        v3 = ft.externalFunc();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//不能调用另一个合约的内部函数</span></span><br><span class="line">        <span class="comment">//Error: Member &quot;internalFunc&quot; not found or not visible after argument-dependent lookup in contract FuntionTest</span></span><br><span class="line">        <span class="comment">//ft.internalFunc();</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">resetV3</span>(<span class="params"></span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        v3 = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-数组"><a href="#8-数组" class="headerlink" title="8.数组"></a>8.数组</h3><h4 id="1-定长数组"><a href="#1-定长数组" class="headerlink" title="1. 定长数组"></a>1. 定长数组</h4><p>bytes1….bytes32</p>
<ul>
<li>字节不可修改</li>
<li>长度不可修改</li>
<li>支持length（只读）</li>
<li>支持下标索引</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.20</span> ;</span><br><span class="line"></span><br><span class="line">contract fixedArray &#123;</span><br><span class="line">    <span class="comment">//bytes1...bytes32</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//bytes1 b1 = &quot;12&quot;;//error</span></span><br><span class="line">    bytes2 public b2 = <span class="string">&quot;ck&quot;</span>; <span class="comment">//0x636b</span></span><br><span class="line">    bytes3 public b3 = <span class="string">&quot;ck&quot;</span>; <span class="comment">//0x636b00</span></span><br><span class="line">    </span><br><span class="line">    uint public len = b3.length; <span class="comment">//length=3</span></span><br><span class="line">    <span class="comment">//b3.length = 10 ; //error</span></span><br><span class="line">    </span><br><span class="line">    bytes1 public b4 = b2[<span class="number">0</span>]; <span class="comment">//0x63-&gt;c</span></span><br><span class="line">    <span class="comment">//b2[1] = &quot;K&quot;; //error    </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-不定长数组"><a href="#2-不定长数组" class="headerlink" title="2.不定长数组"></a>2.不定长数组</h4><p>内容和长度均可修改，包括以下三种：</p>
<ol>
<li><p>类型[长度]</p>
<ul>
<li>动态数组</li>
<li>可以修改</li>
<li>可以改变长度</li>
<li>支持length、push、pop方法</li>
</ul>
<p>可以使用new关键字创建一个memory的数组，与stroage数组不同的是，不能通过length，push，pop的长度来修改数组大小属性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.20</span> ; </span><br><span class="line"></span><br><span class="line">contract unfixedTypeLenTest &#123;</span><br><span class="line">    uint public len2;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">memoryfunc</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//通过new创建数组</span></span><br><span class="line">        uint[] memory value = <span class="keyword">new</span> uint[](<span class="number">10</span>);</span><br><span class="line">        <span class="comment">//uint [10] value = &#123;1,2,3,4,5&#125;;  内容可变，长度不可变</span></span><br><span class="line">        value[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//value.push(2); error</span></span><br><span class="line">        <span class="comment">//value.length = 20; error</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    uint[] public value2;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">storagefunc</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        value2 = <span class="keyword">new</span> uint[](<span class="number">10</span>);<span class="comment">//默认为stroage数组</span></span><br><span class="line">        value2[<span class="number">0</span>] = <span class="number">1</span>;<span class="comment">//修改数组指定下标的数</span></span><br><span class="line">        value2.length = <span class="number">20</span>;<span class="comment">//修改长度</span></span><br><span class="line">        value2.push(<span class="number">2</span>);<span class="comment">//进栈下标为20的数为2</span></span><br><span class="line">        len2 = value2.length;<span class="comment">//20</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>bytes</p>
<ul>
<li>动态字节数组</li>
<li>引用类型</li>
<li>支持下标索引</li>
<li>支持length、push方法</li>
<li>可以修改</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.20</span>;</span><br><span class="line"> </span><br><span class="line">contract unFixedBytes &#123; </span><br><span class="line">    </span><br><span class="line">    bytes public _name = <span class="keyword">new</span> bytes(<span class="number">1</span>);</span><br><span class="line">    bytes public _name2;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setLength</span>(<span class="params">uint length</span>) </span>&#123;</span><br><span class="line">        _name.length = length; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getLength</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> _name.length;</span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setName</span>(<span class="params">bytes name</span>)</span>&#123;</span><br><span class="line">        _name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">changeName</span>(<span class="params">bytes1 name</span>)</span>&#123;</span><br><span class="line">        _name[<span class="number">0</span>] = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setInside</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        _name = <span class="string">&quot;helloWorld&quot;</span>;</span><br><span class="line">        _name2 = <span class="string">&quot;HELLOWORLD&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>string</p>
<ul>
<li>动态尺寸的UTF-8编码字符串，是特殊的可变字节数组</li>
<li>引用类型</li>
<li>不支持下标索引</li>
<li>可以修改（需通过bytes转换），bytes和string可以自由转换</li>
</ul>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.20</span>;</span><br><span class="line"></span><br><span class="line">contract unfixedStringTest &#123;</span><br><span class="line">    string public _name = <span class="string">&quot;lily&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">nameBytes</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">bytes</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bytes(_name); </span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">nameLength</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">returns</span> (<span class="params">uint</span>) </span>&#123; </span><br><span class="line">        <span class="comment">//uint len = _name.length;</span></span><br><span class="line">        <span class="keyword">return</span> bytes(_name).length;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">changeName</span>(<span class="params"></span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        bytes(_name)[<span class="number">0</span>] = <span class="string">&quot;L&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//s2[0] = &quot;H&quot;; //ERROR，不支持下标索引</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">changeLength</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        bytes(_name).length = <span class="number">15</span>;</span><br><span class="line">        bytes(_name)[<span class="number">14</span>] = <span class="string">&quot;x&quot;</span>;</span><br><span class="line">       <span class="comment">// bytes(_name)[19] = &quot;x&quot;; </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>bytes与string之间的转换：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.20</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">contract Test &#123;</span><br><span class="line">    </span><br><span class="line">    bytes10 b10 = <span class="number">0x68656c6c6f776f726c64</span>;     <span class="comment">//helloworld</span></span><br><span class="line">    <span class="comment">//bytes bs10 = b10;</span></span><br><span class="line">    </span><br><span class="line">    bytes public bs10 = <span class="keyword">new</span> bytes(b10.length);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//1. 固定字节数组转动态字节数组</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">fixedBytesToBytes</span>(<span class="params"></span>) <span class="title">public</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (uint i = <span class="number">0</span>; i&lt; b10.length; i++)&#123;</span><br><span class="line">            bs10[i] = b10[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//2. 动态字节数组转string</span></span><br><span class="line">    string  greeting = <span class="string">&quot;helloworld&quot;</span>;</span><br><span class="line">    bytes public b1;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">StringToBytes</span>(<span class="params"></span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        b1 = bytes(greeting);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//3.string转动态字节数组</span></span><br><span class="line">    string public str3;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">BytesToString</span>(<span class="params"></span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        str3 = string(bs10);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4. fixed bytes to String</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">FiexBytesToString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//string tmp = string(b10);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9-结构体"><a href="#9-结构体" class="headerlink" title="9.结构体"></a>9.结构体</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.20</span>;</span><br><span class="line"></span><br><span class="line">contract Test&#123;</span><br><span class="line">    <span class="comment">//定义结构体</span></span><br><span class="line">    struct Student&#123;</span><br><span class="line">        string name;</span><br><span class="line">        uint age;</span><br><span class="line">        uint score;</span><br><span class="line">        string sex;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//两种初始化方法</span></span><br><span class="line">    Student public stu1= Student(<span class="string">&quot;CK&quot;</span> , <span class="number">22</span> , <span class="number">100</span> , <span class="string">&quot;boy&quot;</span>);</span><br><span class="line">    Student public stu2 = Student(&#123;</span><br><span class="line">        <span class="attr">name</span> : <span class="string">&quot;YX&quot;</span>,</span><br><span class="line">        <span class="attr">age</span> :<span class="number">23</span>,</span><br><span class="line">        <span class="attr">score</span> : <span class="number">99</span>,</span><br><span class="line">        <span class="attr">sex</span> : <span class="string">&quot;girl&quot;</span></span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//定义一个结构体数组</span></span><br><span class="line">    Student [] public Students;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">assign</span>(<span class="params"></span>) <span class="title">public</span></span>&#123;</span><br><span class="line">        <span class="comment">//将结构体添加至数组中</span></span><br><span class="line">        Students.push(stu1);</span><br><span class="line">        Students.push(stu2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-字典"><a href="#10-字典" class="headerlink" title="10.字典"></a>10.字典</h3><p>字典（映射）是一对一的键值关系，关键字mapping</p>
<p>语法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mapping(<span class="function"><span class="params">_keyType</span> =&gt;</span> _valueType)</span><br></pre></td></tr></table></figure>

<p>键的类型允许除映射外的所有类型，如数组、合约、枚举、结构体。值的类型无限制。</p>
<p>字典可以被视作为一个哈希表，其中所有可能的键已被虚拟化的创建，被映射到一个默认值（二进制表示的零）。在映射表中，我们并不存储键的数据，而是存储它的哈希值用来查找时使用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.20</span>;</span><br><span class="line"></span><br><span class="line">contract test &#123;</span><br><span class="line">    <span class="comment">//id -&gt; name</span></span><br><span class="line">    mapping(<span class="function"><span class="params">uint</span> =&gt;</span> string) id_names;</span><br><span class="line">    </span><br><span class="line">    <span class="title">constructor</span>(<span class="params"></span>)  <span class="title">public</span>&#123;</span><br><span class="line">        id_names[<span class="number">0x001</span>] = <span class="string">&quot;lily&quot;</span>;</span><br><span class="line">        id_names[<span class="number">0x002</span>] = <span class="string">&quot;Jim&quot;</span>;</span><br><span class="line">        id_names[<span class="number">0x002</span>] = <span class="string">&quot;Lily&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getNameById</span>(<span class="params">uint id</span>) <span class="title">constant</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">string</span>)</span>&#123;</span><br><span class="line">            string storage name = id_names[id];</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="11-自动推导类型"><a href="#11-自动推导类型" class="headerlink" title="11.自动推导类型"></a>11.自动推导类型</h3><p>通过赋值的类型来进行推断。类似于go语言。</p>
<p>函数的参数不可以使用var</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.20</span>;</span><br><span class="line"></span><br><span class="line">contract varTest &#123;</span><br><span class="line">        </span><br><span class="line">    string str1 = <span class="string">&quot;hello!&quot;</span>;</span><br><span class="line">    uint256 public count = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">loopTest</span>(<span class="params"></span>) <span class="title">public</span></span>&#123;</span><br><span class="line">        <span class="comment">//因为这里对i进行自动推导出的时uint8，它一直会死循环，所以不使用i作为退出的条件，用count作为计数器</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i&lt; <span class="number">2000</span> ; i++)&#123;</span><br><span class="line">            count++;</span><br><span class="line">            <span class="comment">//uint8 0-256</span></span><br><span class="line">            <span class="keyword">if</span> (count &gt; <span class="number">257</span>)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> str2 = str1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="storage和memory的区别"><a href="#storage和memory的区别" class="headerlink" title="storage和memory的区别"></a>storage和memory的区别</h2><ol>
<li>storage: 成员变量，可以跨函数调用，有点类似于硬盘；</li>
<li>memory: 临时数据存储，类似于电脑的存储，函数的参数可以理解为memory类型；</li>
</ol>
<h2 id="全局函数-变量"><a href="#全局函数-变量" class="headerlink" title="全局函数/变量"></a>全局函数/变量</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.21</span>;</span><br><span class="line"></span><br><span class="line">contract Test &#123;</span><br><span class="line">    bytes32 public blockhash;</span><br><span class="line">    address public coinbase;</span><br><span class="line">    uint public difficulty;</span><br><span class="line">    uint public gaslimit;</span><br><span class="line">    uint public blockNum;</span><br><span class="line">    uint public timestamp;</span><br><span class="line">    bytes public calldata;</span><br><span class="line">    uint public gas;</span><br><span class="line">    address public sender;</span><br><span class="line">    bytes4 public sig;</span><br><span class="line">    uint public msgValue;</span><br><span class="line">    uint public _now;</span><br><span class="line">    uint public gasPrice;</span><br><span class="line">    address public txOrigin;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">tt</span> (<span class="params"></span>) <span class="title">payable</span> <span class="title">public</span> </span>&#123;</span><br><span class="line">        <span class="comment">//给定区块号的哈希值，只支持最近256个区块，且不包含当前区块</span></span><br><span class="line">        blockhash = block.blockhash(block.number - <span class="number">1</span>);</span><br><span class="line">        coinbase = block.coinbase ;<span class="comment">//当前块矿工的地址。</span></span><br><span class="line">        difficulty = block.difficulty;<span class="comment">//当前块的难度。</span></span><br><span class="line">        gaslimit = block.gaslimit;<span class="comment">// (uint)当前块的gaslimit。</span></span><br><span class="line">        blockNum = block.number;<span class="comment">// (uint)当前区块的块号。</span></span><br><span class="line">        timestamp = block.timestamp;<span class="comment">// (uint)当前块的时间戳。</span></span><br><span class="line">        calldata = msg.data;<span class="comment">// (bytes)完整的调用数据（calldata）。</span></span><br><span class="line">        gas = gasleft();<span class="comment">// (uint)当前还剩的gas。</span></span><br><span class="line">        sender = msg.sender; <span class="comment">// (address)当前调用发起人的地址。</span></span><br><span class="line">        sig = msg.sig;<span class="comment">// (bytes4)调用数据的前四个字节（函数标识符）。</span></span><br><span class="line">        msgValue = msg.value;<span class="comment">// (uint)这个消息所附带的货币量，单位为wei。</span></span><br><span class="line">        _now = now;<span class="comment">// (uint)当前块的时间戳，等同于block.timestamp</span></span><br><span class="line">        gasPrice = tx.gasprice;<span class="comment">// (uint) 交易的gas价格。</span></span><br><span class="line">        txOrigin = tx.origin;<span class="comment">// (address)交易的发送者（完整的调用链）  </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="货币单位与时间单位"><a href="#货币单位与时间单位" class="headerlink" title="货币单位与时间单位"></a>货币单位与时间单位</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//货币单位及换算</span></span><br><span class="line">contract EthUnit&#123;</span><br><span class="line">    uint  a = <span class="number">1</span> ether;</span><br><span class="line">    uint  b = <span class="number">10</span> ** <span class="number">18</span> wei;</span><br><span class="line">    uint  c = <span class="number">1000</span> finney;</span><br><span class="line">    uint  d = <span class="number">1000000</span> szabo;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a == b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f2</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a == c;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f3</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a == d;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f4</span>(<span class="params"></span>) <span class="title">pure</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> ether == <span class="number">100</span> wei;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//时间单位及换算</span></span><br><span class="line">contract TimeUnit&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>) <span class="title">pure</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> == <span class="number">1</span> seconds;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f2</span>(<span class="params"></span>) <span class="title">pure</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> minutes == <span class="number">60</span> seconds;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f3</span>(<span class="params"></span>) <span class="title">pure</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> hours == <span class="number">60</span> minutes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f4</span>(<span class="params"></span>) <span class="title">pure</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> days == <span class="number">24</span> hours;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f5</span>(<span class="params"></span>) <span class="title">pure</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> weeks == <span class="number">7</span> days;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f6</span>(<span class="params"></span>) <span class="title">pure</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">bool</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span> years == <span class="number">365</span> days;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="constant、view和pure"><a href="#constant、view和pure" class="headerlink" title="constant、view和pure"></a>constant、view和pure</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.20</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">contract Test &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//一、constant介绍</span></span><br><span class="line">    uint public v1 = <span class="number">10</span>;</span><br><span class="line">    uint constant v2 = <span class="number">10</span>;</span><br><span class="line">    </span><br><span class="line">    string str1 = <span class="string">&quot;hello!&quot;</span>;</span><br><span class="line">    string constant str2 = <span class="string">&quot;test!&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        v1  = <span class="number">20</span>;</span><br><span class="line">        <span class="comment">//v2 = 30;  //constant修饰的值类型无法被修改</span></span><br><span class="line">        </span><br><span class="line">        str1 = <span class="string">&quot;Hello!&quot;</span>; </span><br><span class="line">       <span class="comment">// str2 = &quot;Test!&quot;;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    struct Person &#123;</span><br><span class="line">        string name;</span><br><span class="line">        uint age;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//Person constant p1;  //constant仅可以修饰值类型，无法修饰引用类型（string除外）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f2</span>(<span class="params"></span>) <span class="title">constant</span> <span class="title">public</span></span>&#123;</span><br><span class="line">        v1 = <span class="number">20</span>; <span class="comment">//constant 修饰的函数内，如果修改了状态变量，那么状态变量的值是无法改变的</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//二、view介绍</span></span><br><span class="line">    <span class="comment">// 1. view只可以修饰函数</span></span><br><span class="line">    <span class="comment">// 2. 它表明该函数内只可以对storage类型的变量进行读取，无法修改</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//三、pure介绍</span></span><br><span class="line">    <span class="comment">//pure</span></span><br><span class="line">    <span class="comment">// 1. pure只可以修饰函数</span></span><br><span class="line">    <span class="comment">// 2. 它表明该函数内，无法读写状态变量</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f3</span>(<span class="params"></span>) <span class="title">pure</span> <span class="title">public</span> <span class="title">returns</span>(<span class="params">uint</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//return v1;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2><p>传统方法： if…throw和throw</p>
<p>新方法：require()、assert()、revert()</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.20</span>;</span><br><span class="line"></span><br><span class="line">contract HasAnOwner &#123;</span><br><span class="line">    address public owner;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//构造函数</span></span><br><span class="line">    <span class="title">constructor</span>(<span class="params"></span>) <span class="title">public</span> &#123;</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">useSuperPowers</span>(<span class="params"></span>)  <span class="title">public</span> </span>&#123; </span><br><span class="line">        <span class="built_in">require</span>(msg.sender == owner);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        if (msg.sender != owner)&#123;</span></span><br><span class="line"><span class="comment">            throw;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        等价于</span></span><br><span class="line"><span class="comment">        if (msg.sender != owner)&#123;</span></span><br><span class="line"><span class="comment">        	revert();</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        assert(msg.sender == owner);</span></span><br><span class="line"><span class="comment">        require(msg.sender == owner);</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h2><p>delete操作符可以用于任何变量，将其设置成默认值，而不是销毁</p>
<p>如果对动态数组delete，则删除所有元素，长度变为0</p>
<p>如果对静态数组delete，则重置所有索引的值</p>
<p>如果对map类型使用delete，什么都不会发送</p>
<p>如果对map的一个键进行delete，则会删除与该键相关的值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.20</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">contract deleteTest &#123;</span><br><span class="line">    string public str1 = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//delete操作符可以用于任何变量(mapping除外)，将其设置成默认值</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">delStr</span>(<span class="params"></span>) <span class="title">public</span></span>&#123;</span><br><span class="line">        <span class="keyword">delete</span> str1;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">setStr</span>(<span class="params"></span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        str1 = <span class="string">&quot;HELLO&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//静态数组，动态数组</span></span><br><span class="line">    uint[<span class="number">10</span>] public staticArray = [<span class="number">4</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>];</span><br><span class="line">    uint[] public dynamicArray = <span class="keyword">new</span> uint[](<span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">intDynamicArray</span> (<span class="params"></span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (uint i = <span class="number">0</span>; i&lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="comment">//dynamicArray[i] = i;</span></span><br><span class="line">            dynamicArray.push(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//如果对静态数组使用delete，则重置所有索引的值</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">delStaticArray</span>(<span class="params"></span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        <span class="keyword">delete</span> staticArray;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//如果对动态数组使用delete，则删除所有元素，其长度变为0</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">delDynamicArray</span>(<span class="params"></span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        <span class="keyword">delete</span> dynamicArray;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getArrayLength</span>(<span class="params"></span>) <span class="title">view</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">uint, uint</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (staticArray.length, dynamicArray.length);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    mapping(<span class="function"><span class="params">uint</span> =&gt;</span> bool) public map1;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">initMap</span>(<span class="params"></span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        map1[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">        map1[<span class="number">2</span>] = <span class="literal">true</span>;</span><br><span class="line">        map1[<span class="number">3</span>] = <span class="literal">false</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//delete map1;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">deleMapByKey</span>(<span class="params">uint key</span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        <span class="keyword">delete</span> map1[key];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//delete map1;</span></span><br><span class="line">    </span><br><span class="line">    struct Person &#123;</span><br><span class="line">        string name;</span><br><span class="line">        mapping(<span class="function"><span class="params">string</span> =&gt;</span> uint) nameScore;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Person public p1;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">initP1</span>(<span class="params"></span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        p1.name = <span class="string">&quot;duke&quot;</span>;</span><br><span class="line">        p1.nameScore[<span class="string">&quot;duke&quot;</span>] = <span class="number">80</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">returnP1</span>(<span class="params"></span>) <span class="title">view</span> <span class="title">public</span> <span class="title">returns</span> (<span class="params">string, uint</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (p1.name, p1.nameScore[<span class="string">&quot;duke&quot;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">deleteP1name</span>(<span class="params"></span>) <span class="title">public</span> </span>&#123;</span><br><span class="line">        <span class="keyword">delete</span> p1;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">deleteP1Score</span>(<span class="params"></span>) <span class="title">public</span></span>&#123;</span><br><span class="line">        <span class="keyword">delete</span> p1.nameScore[<span class="string">&quot;duke&quot;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="modifier修饰器"><a href="#modifier修饰器" class="headerlink" title="modifier修饰器"></a>modifier修饰器</h2><p>modifier可以用来改变一个函数的行为，比如用于在函数执行前检查某种前置条件。修饰器是一种合约的属性，可以被继承，同时还可以被派生的合约重写（override）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.20</span>;</span><br><span class="line"></span><br><span class="line">contract HasAnOwner &#123;</span><br><span class="line">    address public owner;</span><br><span class="line">    uint public a ;</span><br><span class="line">    </span><br><span class="line">    <span class="title">constructor</span>(<span class="params"></span>) <span class="title">public</span> &#123;</span><br><span class="line">        owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    modifier <span class="function"><span class="title">ownerOnly</span>(<span class="params">address addr</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">require</span>(addr == owner);</span><br><span class="line">        <span class="comment">//下划线表示修饰器所修饰函数的代码,也就是a=10这段代码</span></span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">useSuperPowers</span>(<span class="params"></span>) <span class="title">ownerOnly</span>(<span class="params">msg.sender</span>) <span class="title">public</span> </span>&#123;    </span><br><span class="line">        a = <span class="number">10</span>;</span><br><span class="line">       <span class="comment">// do something only the owner should be allowed to do</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="投票案例"><a href="#投票案例" class="headerlink" title="投票案例"></a>投票案例</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.20</span>;</span><br><span class="line">pragma experimental ABIEncoderV2;</span><br><span class="line"></span><br><span class="line">contract VoteContent&#123;</span><br><span class="line">    <span class="comment">//投票人</span></span><br><span class="line">    struct Voter&#123;</span><br><span class="line">        uint voteNumber;<span class="comment">//投票号</span></span><br><span class="line">        bool isVoild;<span class="comment">//是否投过票</span></span><br><span class="line">        uint weight;<span class="comment">//投票权重，初始值为1，被委托作为代理人后，权重增加</span></span><br><span class="line">        address agent;<span class="comment">//指定代理人</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//候选人</span></span><br><span class="line">    struct Candidate&#123;</span><br><span class="line">        string name;<span class="comment">//候选人姓名</span></span><br><span class="line">        uint voteCount;<span class="comment">//获得的投票数</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//合约创建人，负责创建合约，授权给地址，使之成为投票人</span></span><br><span class="line">    address public admin;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//定义候选人集合</span></span><br><span class="line">    Candidate [] public candidates;</span><br><span class="line">    <span class="comment">//定义投票人集合</span></span><br><span class="line">    mapping(<span class="function"><span class="params">address</span> =&gt;</span> Voter) public voters;</span><br><span class="line">    </span><br><span class="line">    <span class="title">constructor</span>(<span class="params">string[] candidatesNames</span>) <span class="title">public</span>&#123;</span><br><span class="line">        admin = msg.sender;</span><br><span class="line">        <span class="comment">//每一个名字都生成一个候选人，添加到候选人集合中</span></span><br><span class="line">        <span class="keyword">for</span> (uint i = <span class="number">0</span> ; i &lt; candidatesNames.length ; i++)&#123;</span><br><span class="line">            Candidate memory tmp = Candidate(&#123;</span><br><span class="line">                <span class="attr">name</span> : candidatesNames[i],</span><br><span class="line">                <span class="attr">voteCount</span> : <span class="number">0</span></span><br><span class="line">            &#125;);</span><br><span class="line">            candidates.push(tmp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//修饰器，使管理员才有权限</span></span><br><span class="line">    modifier <span class="function"><span class="title">adminOnly</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">require</span>(admin == msg.sender);</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//只有管理员有添加投票人的权力</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">giveVoteRightTo</span>(<span class="params">address addr</span>) <span class="title">adminOnly</span> <span class="title">public</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (voters[addr].weight &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            revert();</span><br><span class="line">        &#125;</span><br><span class="line">        voters[addr].weight = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">agentFunc</span>(<span class="params">address to</span>) <span class="title">public</span></span>&#123;</span><br><span class="line">        Voter storage voter = voters[msg.sender];</span><br><span class="line">        <span class="comment">//如果不是投票人或者已经投过票则不能委托 </span></span><br><span class="line">        <span class="keyword">if</span> (voter.weight &lt;= <span class="number">0</span> || voter.isVoild)&#123;</span><br><span class="line">            revert();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//轮询找到最终的代理人</span></span><br><span class="line">        <span class="keyword">while</span> (voters[to].agent != address(<span class="number">0</span>) &amp;&amp; voters[to].agent != msg.sender)&#123;</span><br><span class="line">            to = voters[to].agent;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//这个代理人不能是自己</span></span><br><span class="line">        <span class="built_in">require</span>(msg.sender != to);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//设置自己为已经投票</span></span><br><span class="line">        voter.isVoild = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">//将to设置为自己的代理人</span></span><br><span class="line">        voter.agent = to;</span><br><span class="line">        <span class="comment">//设置最终代理人</span></span><br><span class="line">        Voter storage finalAgent = voters[to];</span><br><span class="line">        <span class="comment">//如果代理人投过票</span></span><br><span class="line">        <span class="keyword">if</span> (finalAgent.isVoild)&#123;</span><br><span class="line">            <span class="comment">//在候选人的得票数加上自己的权重</span></span><br><span class="line">            candidates[finalAgent.voteNumber].voteCount += voter.weight;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//否则在代理人的权重上加上自己的权重</span></span><br><span class="line">            finalAgent.weight += voter.weight;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">vote</span>(<span class="params">uint voteNum</span>) <span class="title">public</span></span>&#123;</span><br><span class="line">        Voter storage voter = voters[msg.sender];</span><br><span class="line">        <span class="comment">//如果不是投票人或者已经投过票则不能投票</span></span><br><span class="line">        <span class="keyword">if</span> (voter.weight &lt;= <span class="number">0</span> || voter.isVoild)&#123;</span><br><span class="line">            revert();</span><br><span class="line">        &#125;</span><br><span class="line">    	<span class="comment">//修改为投过票了</span></span><br><span class="line">        voter.isVoild = <span class="literal">true</span>;</span><br><span class="line">        <span class="comment">//赋值投票号</span></span><br><span class="line">        voter.voteNumber = voteNum;</span><br><span class="line">        <span class="comment">//获得投票的候选人票数增加权重个</span></span><br><span class="line">        candidates[voteNum].voteCount += voter.weight;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">whoWin</span>(<span class="params"></span>) <span class="title">public</span> <span class="title">returns</span>(<span class="params">string , uint</span>) </span>&#123;</span><br><span class="line">        string winner;</span><br><span class="line">        uint winnerVoteCount;</span><br><span class="line">        <span class="comment">//找到所有的候选人谁得票多</span></span><br><span class="line">        <span class="keyword">for</span> (uint i = <span class="number">0</span> ; i &lt; candidates.length ; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (candidates[i].voteCount &gt; winnerVoteCount)&#123;</span><br><span class="line">                winnerVoteCount = candidates[i].voteCount;</span><br><span class="line">                winner = candidates[i].name;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回得票最多的人的姓名和得票数</span></span><br><span class="line">        <span class="keyword">return</span> (winner,winnerVoteCount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;]</span></span><br></pre></td></tr></table></figure>


                            </div>

                            
                                <section class="post-copyright">
                                    
                                            
                                                    
                                                            

                                </section>
                                
                                    <section class="post-tags">
                                        <div>
                                            <span>标签:</span>
                                            <span class="tag">
                    
                    
                        <a href="/tags/%E4%BB%A5%E5%A4%AA%E5%9D%8A/"># 以太坊</a>
                    
                        
                </span>
                                        </div>
                                        <div>
                                            <a href="javascript:window.history.back();">back</a>
                                            <span>· </span>
                                            <a href="/">home</a>
                                        </div>
                                    </section>
                                    <section class="post-nav">
                                        
                                            <a class="prev" rel="prev" href="/2020/02/11/Geth%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E9%93%BE/">
                                                Geth搭建私有链
                                            </a>
                                            
                                                
                                                    <a class="next" rel="next" href="/2020/01/22/%E6%A8%A1%E6%8B%9F%E6%AF%94%E7%89%B9%E5%B8%81%E4%BA%A4%E6%98%93/">
                                                        Go语言模拟比特币交易
                                                    </a>
                                                    
                                    </section>


                        </article>
</div>
        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Night Scholar | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
